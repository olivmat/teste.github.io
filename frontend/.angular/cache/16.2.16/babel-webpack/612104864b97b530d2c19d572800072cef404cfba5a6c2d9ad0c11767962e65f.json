{"ast":null,"code":"import { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/material/dialog\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"@angular/common/http\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/material/button\";\nimport * as i6 from \"@angular/material/input\";\nimport * as i7 from \"@angular/material/form-field\";\nfunction PresencaCadastroModalComponent_table_15_tr_12_img_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"img\", 17);\n  }\n  if (rf & 2) {\n    const pessoa_r2 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵproperty(\"src\", pessoa_r2.foto, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction PresencaCadastroModalComponent_table_15_tr_12_span_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 18);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const pessoa_r2 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", pessoa_r2.sexo === \"Masculino\" ? \"\\uD83D\\uDC66\" : pessoa_r2.sexo === \"Feminino\" ? \"\\uD83D\\uDC67\" : \"\\uD83D\\uDC76\", \" \");\n  }\n}\nfunction PresencaCadastroModalComponent_table_15_tr_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtemplate(2, PresencaCadastroModalComponent_table_15_tr_12_img_2_Template, 1, 1, \"img\", 14);\n    i0.ɵɵtemplate(3, PresencaCadastroModalComponent_table_15_tr_12_span_3_Template, 2, 1, \"span\", 15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"td\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"td\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"td\")(9, \"button\", 16);\n    i0.ɵɵlistener(\"click\", function PresencaCadastroModalComponent_table_15_tr_12_Template_button_click_9_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const pessoa_r2 = restoredCtx.$implicit;\n      const ctx_r7 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r7.selecionarPessoa(pessoa_r2));\n    });\n    i0.ɵɵtext(10, \"Selecionar\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const pessoa_r2 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵclassProp(\"selected\", ctx_r1.pessoaSelecionada && ctx_r1.pessoaSelecionada.id === pessoa_r2.id);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", pessoa_r2.foto && (pessoa_r2.foto.startsWith(\"http\") || pessoa_r2.foto.startsWith(\"/uploads/\")));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !pessoa_r2.foto || pessoa_r2.foto === \"-\" || !pessoa_r2.foto.startsWith(\"http\") && !pessoa_r2.foto.startsWith(\"/uploads/\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(pessoa_r2.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(pessoa_r2.responsavel);\n  }\n}\nfunction PresencaCadastroModalComponent_table_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"table\", 12)(1, \"thead\")(2, \"tr\")(3, \"th\");\n    i0.ɵɵtext(4, \"Foto\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"th\");\n    i0.ɵɵtext(6, \"Nome\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"th\");\n    i0.ɵɵtext(8, \"Respons\\u00E1vel\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"th\");\n    i0.ɵɵtext(10, \"Selecionar\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(11, \"tbody\");\n    i0.ɵɵtemplate(12, PresencaCadastroModalComponent_table_15_tr_12_Template, 11, 6, \"tr\", 13);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(12);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.pessoasFiltradas);\n  }\n}\nconst _c0 = function () {\n  return {\n    standalone: true\n  };\n};\nexport class PresencaCadastroModalComponent {\n  constructor(dialogRef, fb, http, data) {\n    this.dialogRef = dialogRef;\n    this.fb = fb;\n    this.http = http;\n    this.data = data;\n    this.pessoas = [];\n    this.pessoasFiltradas = [];\n    this.buscaNome = '';\n    this.pessoaSelecionada = null;\n    this.today = new Date();\n    this.presencas = [];\n    this.presencaForm = this.fb.group({\n      person_id: ['', Validators.required],\n      date: [new Date(), Validators.required]\n    });\n    if (data && data.presencas) {\n      this.presencas = data.presencas;\n    }\n  }\n  ngOnInit() {\n    this.http.get('http://localhost:8000/people/').subscribe(data => {\n      this.pessoas = data;\n      this.filtrarPessoas();\n    });\n  }\n  filtrarPessoas() {\n    const termo = this.buscaNome.trim().toLowerCase();\n    if (!termo) {\n      this.pessoasFiltradas = this.pessoas;\n    } else {\n      this.pessoasFiltradas = this.pessoas.filter(p => p.name.toLowerCase().startsWith(termo));\n    }\n  }\n  selecionarPessoa(pessoa) {\n    this.pessoaSelecionada = pessoa;\n    this.presencaForm.patchValue({\n      person_id: pessoa.id\n    });\n  }\n  onSubmit() {\n    console.log('onSubmit chamado', this.presencaForm.value, this.pessoaSelecionada);\n    if (this.presencaForm.valid) {\n      const presencaData = this.presencaForm.value;\n      const dataHoje = this.formatarData(presencaData.date);\n      const jaRegistrada = this.presencas.some(p => p.person_id === presencaData.person_id && this.formatarData(p.date) === dataHoje);\n      if (jaRegistrada) {\n        alert('Já foi registrada a presença dessa criança hoje');\n        return;\n      }\n      this.http.post('http://localhost:8000/presences/', {\n        person_id: presencaData.person_id,\n        date: dataHoje\n      }).subscribe(response => {\n        this.presencas.push({\n          person_id: presencaData.person_id,\n          date: dataHoje\n        });\n        this.dialogRef.close(true);\n      }, error => {\n        alert('Criança já registrada hoje ⚠️');\n      });\n    }\n  }\n  formatarData(date) {\n    if (date instanceof Date) {\n      return date.toISOString().split('T')[0];\n    }\n    return date;\n  }\n  onCancel() {\n    this.dialogRef.close();\n  }\n  static {\n    this.ɵfac = function PresencaCadastroModalComponent_Factory(t) {\n      return new (t || PresencaCadastroModalComponent)(i0.ɵɵdirectiveInject(i1.MatDialogRef), i0.ɵɵdirectiveInject(i2.FormBuilder), i0.ɵɵdirectiveInject(i3.HttpClient), i0.ɵɵdirectiveInject(MAT_DIALOG_DATA));\n    };\n  }\n  static {\n    this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: PresencaCadastroModalComponent,\n      selectors: [[\"app-presenca-cadastro-modal\"]],\n      decls: 21,\n      vars: 10,\n      consts: [[\"mat-dialog-title\", \"\"], [1, \"data-atual-container-top\"], [\"appearance\", \"outline\", 2, \"width\", \"180px\", \"float\", \"right\"], [\"matInput\", \"\", \"readonly\", \"\", 3, \"value\"], [1, \"form-container\", 3, \"formGroup\", \"ngSubmit\"], [\"appearance\", \"outline\", 2, \"width\", \"100%\", \"margin-bottom\", \"8px\"], [\"matInput\", \"\", \"placeholder\", \"Digite o nome...\", 3, \"ngModel\", \"ngModelOptions\", \"ngModelChange\"], [1, \"caixa-vazia\"], [\"class\", \"tabela-cadastro-crianca\", 4, \"ngIf\"], [\"align\", \"end\"], [\"mat-button\", \"\", \"type\", \"button\", 3, \"click\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", \"type\", \"submit\", 3, \"disabled\", \"click\"], [1, \"tabela-cadastro-crianca\"], [3, \"selected\", 4, \"ngFor\", \"ngForOf\"], [\"alt\", \"Foto\", \"class\", \"foto-avatar\", 3, \"src\", 4, \"ngIf\"], [\"class\", \"foto-avatar\", 4, \"ngIf\"], [\"mat-button\", \"\", \"color\", \"primary\", \"type\", \"button\", 3, \"click\"], [\"alt\", \"Foto\", 1, \"foto-avatar\", 3, \"src\"], [1, \"foto-avatar\"]],\n      template: function PresencaCadastroModalComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"h2\", 0);\n          i0.ɵɵtext(1, \"Registrar Presen\\u00E7a\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(2, \"mat-dialog-content\")(3, \"div\", 1)(4, \"mat-form-field\", 2)(5, \"mat-label\");\n          i0.ɵɵtext(6, \"Data\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(7, \"input\", 3);\n          i0.ɵɵpipe(8, \"date\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(9, \"form\", 4);\n          i0.ɵɵlistener(\"ngSubmit\", function PresencaCadastroModalComponent_Template_form_ngSubmit_9_listener() {\n            return ctx.onSubmit();\n          });\n          i0.ɵɵelementStart(10, \"mat-form-field\", 5)(11, \"mat-label\");\n          i0.ɵɵtext(12, \"Buscar pelo nome da crian\\u00E7a\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(13, \"input\", 6);\n          i0.ɵɵlistener(\"ngModelChange\", function PresencaCadastroModalComponent_Template_input_ngModelChange_13_listener($event) {\n            return ctx.buscaNome = $event;\n          })(\"ngModelChange\", function PresencaCadastroModalComponent_Template_input_ngModelChange_13_listener() {\n            return ctx.filtrarPessoas();\n          });\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(14, \"div\", 7);\n          i0.ɵɵtemplate(15, PresencaCadastroModalComponent_table_15_Template, 13, 1, \"table\", 8);\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(16, \"mat-dialog-actions\", 9)(17, \"button\", 10);\n          i0.ɵɵlistener(\"click\", function PresencaCadastroModalComponent_Template_button_click_17_listener() {\n            return ctx.onCancel();\n          });\n          i0.ɵɵtext(18, \"Cancelar\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(19, \"button\", 11);\n          i0.ɵɵlistener(\"click\", function PresencaCadastroModalComponent_Template_button_click_19_listener() {\n            return ctx.onSubmit();\n          });\n          i0.ɵɵtext(20, \" Registrar \");\n          i0.ɵɵelementEnd()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"value\", i0.ɵɵpipeBind2(8, 6, ctx.today, \"dd/MM/yyyy\"));\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"formGroup\", ctx.presencaForm);\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngModel\", ctx.buscaNome)(\"ngModelOptions\", i0.ɵɵpureFunction0(9, _c0));\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngIf\", ctx.pessoasFiltradas.length > 0);\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"disabled\", !ctx.presencaForm.valid || !ctx.pessoaSelecionada);\n        }\n      },\n      dependencies: [i4.NgForOf, i4.NgIf, i2.ɵNgNoValidate, i2.DefaultValueAccessor, i2.NgControlStatus, i2.NgControlStatusGroup, i2.NgModel, i2.FormGroupDirective, i5.MatButton, i6.MatInput, i7.MatFormField, i7.MatLabel, i1.MatDialogTitle, i1.MatDialogContent, i1.MatDialogActions, i4.DatePipe],\n      styles: [\"h2[mat-dialog-title][_ngcontent-%COMP%] {\\n  margin: 0 0 16px;\\n  color: #333;\\n  font-size: 20px;\\n  font-weight: 500;\\n  display: flex;\\n  align-items: center;\\n  gap: 8px;\\n}\\n\\n.form-container[_ngcontent-%COMP%] {\\n  display: flex;\\n  flex-direction: column;\\n  gap: 16px;\\n  min-width: 600px;\\n  padding: 16px 0;\\n}\\n\\n.caixa-vazia[_ngcontent-%COMP%] {\\n  width: 100%;\\n  min-height: 32px;\\n  background: #f5f5f5;\\n  border-radius: 8px;\\n  margin-bottom: 12px;\\n  padding: 8px 0;\\n}\\n\\n.tabela-cadastro-crianca[_ngcontent-%COMP%] {\\n  width: 100%;\\n  border-collapse: separate;\\n  border-spacing: 0 2px;\\n  background: #fff;\\n  font-size: 14px;\\n}\\n.tabela-cadastro-crianca[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .tabela-cadastro-crianca[_ngcontent-%COMP%]   td[_ngcontent-%COMP%] {\\n  padding: 4px 8px;\\n  vertical-align: middle;\\n  border-bottom: 1px solid #f0f0f0;\\n}\\n.tabela-cadastro-crianca[_ngcontent-%COMP%]   th[_ngcontent-%COMP%] {\\n  background: #f5f5f5;\\n  font-weight: 600;\\n}\\n.tabela-cadastro-crianca[_ngcontent-%COMP%]   .foto-avatar[_ngcontent-%COMP%] {\\n  width: 36px;\\n  height: 36px;\\n  object-fit: cover;\\n  border-radius: 50%;\\n  border: 2px solid #eee;\\n  background: #fafafa;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  font-size: 20px;\\n  margin: 0 auto;\\n}\\n.tabela-cadastro-crianca[_ngcontent-%COMP%]   tr.selected[_ngcontent-%COMP%] {\\n  background: #e3f2fd !important;\\n}\\n\\n.data-atual-container-top[_ngcontent-%COMP%] {\\n  width: 100%;\\n  display: flex;\\n  justify-content: flex-end;\\n  margin-bottom: 8px;\\n}\\n\\n.data-atual-container-top[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%] {\\n  min-width: 160px;\\n  max-width: 200px;\\n} \\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvcHJlc2VuY2EvcHJlc2VuY2EtY2FkYXN0cm8tbW9kYWwvcHJlc2VuY2EtY2FkYXN0cm8tbW9kYWwuY29tcG9uZW50LmNzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLGdCQUFnQjtFQUNoQixXQUFXO0VBQ1gsZUFBZTtFQUNmLGdCQUFnQjtFQUNoQixhQUFhO0VBQ2IsbUJBQW1CO0VBQ25CLFFBQVE7QUFDVjs7QUFFQTtFQUNFLGFBQWE7RUFDYixzQkFBc0I7RUFDdEIsU0FBUztFQUNULGdCQUFnQjtFQUNoQixlQUFlO0FBQ2pCOztBQUVBO0VBQ0UsV0FBVztFQUNYLGdCQUFnQjtFQUNoQixtQkFBbUI7RUFDbkIsa0JBQWtCO0VBQ2xCLG1CQUFtQjtFQUNuQixjQUFjO0FBQ2hCOztBQUVBO0VBQ0UsV0FBVztFQUNYLHlCQUF5QjtFQUN6QixxQkFBcUI7RUFDckIsZ0JBQWdCO0VBQ2hCLGVBQWU7QUFDakI7QUFDQTtFQUNFLGdCQUFnQjtFQUNoQixzQkFBc0I7RUFDdEIsZ0NBQWdDO0FBQ2xDO0FBQ0E7RUFDRSxtQkFBbUI7RUFDbkIsZ0JBQWdCO0FBQ2xCO0FBQ0E7RUFDRSxXQUFXO0VBQ1gsWUFBWTtFQUNaLGlCQUFpQjtFQUNqQixrQkFBa0I7RUFDbEIsc0JBQXNCO0VBQ3RCLG1CQUFtQjtFQUNuQixhQUFhO0VBQ2IsbUJBQW1CO0VBQ25CLHVCQUF1QjtFQUN2QixlQUFlO0VBQ2YsY0FBYztBQUNoQjtBQUNBO0VBQ0UsOEJBQThCO0FBQ2hDOztBQUVBO0VBQ0UsV0FBVztFQUNYLGFBQWE7RUFDYix5QkFBeUI7RUFDekIsa0JBQWtCO0FBQ3BCOztBQUVBO0VBQ0UsZ0JBQWdCO0VBQ2hCLGdCQUFnQjtBQUNsQiIsInNvdXJjZXNDb250ZW50IjpbImgyW21hdC1kaWFsb2ctdGl0bGVdIHtcclxuICBtYXJnaW46IDAgMCAxNnB4O1xyXG4gIGNvbG9yOiAjMzMzO1xyXG4gIGZvbnQtc2l6ZTogMjBweDtcclxuICBmb250LXdlaWdodDogNTAwO1xyXG4gIGRpc3BsYXk6IGZsZXg7XHJcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcclxuICBnYXA6IDhweDtcclxufVxyXG5cclxuLmZvcm0tY29udGFpbmVyIHtcclxuICBkaXNwbGF5OiBmbGV4O1xyXG4gIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XHJcbiAgZ2FwOiAxNnB4O1xyXG4gIG1pbi13aWR0aDogNjAwcHg7XHJcbiAgcGFkZGluZzogMTZweCAwO1xyXG59XHJcblxyXG4uY2FpeGEtdmF6aWEge1xyXG4gIHdpZHRoOiAxMDAlO1xyXG4gIG1pbi1oZWlnaHQ6IDMycHg7XHJcbiAgYmFja2dyb3VuZDogI2Y1ZjVmNTtcclxuICBib3JkZXItcmFkaXVzOiA4cHg7XHJcbiAgbWFyZ2luLWJvdHRvbTogMTJweDtcclxuICBwYWRkaW5nOiA4cHggMDtcclxufVxyXG5cclxuLnRhYmVsYS1jYWRhc3Ryby1jcmlhbmNhIHtcclxuICB3aWR0aDogMTAwJTtcclxuICBib3JkZXItY29sbGFwc2U6IHNlcGFyYXRlO1xyXG4gIGJvcmRlci1zcGFjaW5nOiAwIDJweDtcclxuICBiYWNrZ3JvdW5kOiAjZmZmO1xyXG4gIGZvbnQtc2l6ZTogMTRweDtcclxufVxyXG4udGFiZWxhLWNhZGFzdHJvLWNyaWFuY2EgdGgsIC50YWJlbGEtY2FkYXN0cm8tY3JpYW5jYSB0ZCB7XHJcbiAgcGFkZGluZzogNHB4IDhweDtcclxuICB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlO1xyXG4gIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZjBmMGYwO1xyXG59XHJcbi50YWJlbGEtY2FkYXN0cm8tY3JpYW5jYSB0aCB7XHJcbiAgYmFja2dyb3VuZDogI2Y1ZjVmNTtcclxuICBmb250LXdlaWdodDogNjAwO1xyXG59XHJcbi50YWJlbGEtY2FkYXN0cm8tY3JpYW5jYSAuZm90by1hdmF0YXIge1xyXG4gIHdpZHRoOiAzNnB4O1xyXG4gIGhlaWdodDogMzZweDtcclxuICBvYmplY3QtZml0OiBjb3ZlcjtcclxuICBib3JkZXItcmFkaXVzOiA1MCU7XHJcbiAgYm9yZGVyOiAycHggc29saWQgI2VlZTtcclxuICBiYWNrZ3JvdW5kOiAjZmFmYWZhO1xyXG4gIGRpc3BsYXk6IGZsZXg7XHJcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcclxuICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjtcclxuICBmb250LXNpemU6IDIwcHg7XHJcbiAgbWFyZ2luOiAwIGF1dG87XHJcbn1cclxuLnRhYmVsYS1jYWRhc3Ryby1jcmlhbmNhIHRyLnNlbGVjdGVkIHtcclxuICBiYWNrZ3JvdW5kOiAjZTNmMmZkICFpbXBvcnRhbnQ7XHJcbn1cclxuXHJcbi5kYXRhLWF0dWFsLWNvbnRhaW5lci10b3Age1xyXG4gIHdpZHRoOiAxMDAlO1xyXG4gIGRpc3BsYXk6IGZsZXg7XHJcbiAganVzdGlmeS1jb250ZW50OiBmbGV4LWVuZDtcclxuICBtYXJnaW4tYm90dG9tOiA4cHg7XHJcbn1cclxuXHJcbi5kYXRhLWF0dWFsLWNvbnRhaW5lci10b3AgLm1hdC1mb3JtLWZpZWxkIHtcclxuICBtaW4td2lkdGg6IDE2MHB4O1xyXG4gIG1heC13aWR0aDogMjAwcHg7XHJcbn0gIl0sInNvdXJjZVJvb3QiOiIifQ== */\"]\n    });\n  }\n}","map":{"version":3,"names":["MAT_DIALOG_DATA","Validators","i0","ɵɵelement","ɵɵproperty","pessoa_r2","foto","ɵɵsanitizeUrl","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵadvance","ɵɵtextInterpolate1","sexo","ɵɵtemplate","PresencaCadastroModalComponent_table_15_tr_12_img_2_Template","PresencaCadastroModalComponent_table_15_tr_12_span_3_Template","ɵɵlistener","PresencaCadastroModalComponent_table_15_tr_12_Template_button_click_9_listener","restoredCtx","ɵɵrestoreView","_r8","$implicit","ctx_r7","ɵɵnextContext","ɵɵresetView","selecionarPessoa","ɵɵclassProp","ctx_r1","pessoaSelecionada","id","startsWith","ɵɵtextInterpolate","name","responsavel","PresencaCadastroModalComponent_table_15_tr_12_Template","ctx_r0","pessoasFiltradas","PresencaCadastroModalComponent","constructor","dialogRef","fb","http","data","pessoas","buscaNome","today","Date","presencas","presencaForm","group","person_id","required","date","ngOnInit","get","subscribe","filtrarPessoas","termo","trim","toLowerCase","filter","p","pessoa","patchValue","onSubmit","console","log","value","valid","presencaData","dataHoje","formatarData","jaRegistrada","some","alert","post","response","push","close","error","toISOString","split","onCancel","ɵɵdirectiveInject","i1","MatDialogRef","i2","FormBuilder","i3","HttpClient","selectors","decls","vars","consts","template","PresencaCadastroModalComponent_Template","rf","ctx","PresencaCadastroModalComponent_Template_form_ngSubmit_9_listener","PresencaCadastroModalComponent_Template_input_ngModelChange_13_listener","$event","PresencaCadastroModalComponent_table_15_Template","PresencaCadastroModalComponent_Template_button_click_17_listener","PresencaCadastroModalComponent_Template_button_click_19_listener","ɵɵpipeBind2","ɵɵpureFunction0","_c0","length"],"sources":["C:\\Users\\mathe\\Documents\\Kids\\Cadastro Local Kids\\frontend\\src\\app\\presenca\\presenca-cadastro-modal\\presenca-cadastro-modal.component.ts","C:\\Users\\mathe\\Documents\\Kids\\Cadastro Local Kids\\frontend\\src\\app\\presenca\\presenca-cadastro-modal\\presenca-cadastro-modal.component.html"],"sourcesContent":["import { Component, OnInit, Inject } from '@angular/core';\r\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\r\nimport { FormBuilder, FormGroup, Validators } from '@angular/forms';\r\nimport { HttpClient } from '@angular/common/http';\r\n\r\n@Component({\r\n  selector: 'app-presenca-cadastro-modal',\r\n  templateUrl: './presenca-cadastro-modal.component.html',\r\n  styleUrls: ['./presenca-cadastro-modal.component.css']\r\n})\r\nexport class PresencaCadastroModalComponent implements OnInit {\r\n  presencaForm: FormGroup;\r\n  pessoas: any[] = [];\r\n  pessoasFiltradas: any[] = [];\r\n  buscaNome: string = '';\r\n  pessoaSelecionada: any = null;\r\n  today: Date = new Date();\r\n  presencas: any[] = [];\r\n\r\n  constructor(\r\n    private dialogRef: MatDialogRef<PresencaCadastroModalComponent>,\r\n    private fb: FormBuilder,\r\n    private http: HttpClient,\r\n    @Inject(MAT_DIALOG_DATA) public data: any\r\n  ) {\r\n    this.presencaForm = this.fb.group({\r\n      person_id: ['', Validators.required],\r\n      date: [new Date(), Validators.required]\r\n    });\r\n    if (data && data.presencas) {\r\n      this.presencas = data.presencas;\r\n    }\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    this.http.get('http://localhost:8000/people/').subscribe((data: any) => {\r\n      this.pessoas = data;\r\n      this.filtrarPessoas();\r\n    });\r\n  }\r\n\r\n  filtrarPessoas() {\r\n    const termo = this.buscaNome.trim().toLowerCase();\r\n    if (!termo) {\r\n      this.pessoasFiltradas = this.pessoas;\r\n    } else {\r\n      this.pessoasFiltradas = this.pessoas.filter(p => p.name.toLowerCase().startsWith(termo));\r\n    }\r\n  }\r\n\r\n  selecionarPessoa(pessoa: any) {\r\n    this.pessoaSelecionada = pessoa;\r\n    this.presencaForm.patchValue({ person_id: pessoa.id });\r\n  }\r\n\r\n  onSubmit() {\r\n    console.log('onSubmit chamado', this.presencaForm.value, this.pessoaSelecionada);\r\n    if (this.presencaForm.valid) {\r\n      const presencaData = this.presencaForm.value;\r\n      const dataHoje = this.formatarData(presencaData.date);\r\n      const jaRegistrada = this.presencas.some(p =>\r\n        p.person_id === presencaData.person_id &&\r\n        this.formatarData(p.date) === dataHoje\r\n      );\r\n      if (jaRegistrada) {\r\n        alert('Já foi registrada a presença dessa criança hoje');\r\n        return;\r\n      }\r\n      this.http.post('http://localhost:8000/presences/', {\r\n        person_id: presencaData.person_id,\r\n        date: dataHoje\r\n      }).subscribe(\r\n        response => {\r\n          this.presencas.push({\r\n            person_id: presencaData.person_id,\r\n            date: dataHoje\r\n          });\r\n          this.dialogRef.close(true);\r\n        },\r\n        error => {\r\n          alert('Criança já registrada hoje ⚠️');\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  formatarData(date: any): string {\r\n    if (date instanceof Date) {\r\n      return date.toISOString().split('T')[0];\r\n    }\r\n    return date;\r\n  }\r\n\r\n  onCancel() {\r\n    this.dialogRef.close();\r\n  }\r\n} ","<h2 mat-dialog-title>Registrar Presença</h2>\r\n<mat-dialog-content>\r\n  <div class=\"data-atual-container-top\">\r\n    <mat-form-field appearance=\"outline\" style=\"width: 180px; float: right;\">\r\n      <mat-label>Data</mat-label>\r\n      <input matInput [value]=\"today | date:'dd/MM/yyyy'\" readonly />\r\n    </mat-form-field>\r\n  </div>\r\n  <form [formGroup]=\"presencaForm\" (ngSubmit)=\"onSubmit()\" class=\"form-container\">\r\n    <mat-form-field appearance=\"outline\" style=\"width: 100%; margin-bottom: 8px;\">\r\n      <mat-label>Buscar pelo nome da criança</mat-label>\r\n      <input matInput [(ngModel)]=\"buscaNome\" (ngModelChange)=\"filtrarPessoas()\" placeholder=\"Digite o nome...\" [ngModelOptions]=\"{standalone: true}\" />\r\n    </mat-form-field>\r\n    <div class=\"caixa-vazia\">\r\n      <table *ngIf=\"pessoasFiltradas.length > 0\" class=\"tabela-cadastro-crianca\">\r\n        <thead>\r\n          <tr>\r\n            <th>Foto</th>\r\n            <th>Nome</th>\r\n            <th>Responsável</th>\r\n            <th>Selecionar</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <tr *ngFor=\"let pessoa of pessoasFiltradas\" [class.selected]=\"pessoaSelecionada && pessoaSelecionada.id === pessoa.id\">\r\n            <td>\r\n              <img *ngIf=\"pessoa.foto && (pessoa.foto.startsWith('http') || pessoa.foto.startsWith('/uploads/'))\" [src]=\"pessoa.foto\" alt=\"Foto\" class=\"foto-avatar\" />\r\n              <span *ngIf=\"!pessoa.foto || pessoa.foto === '-' || (!pessoa.foto.startsWith('http') && !pessoa.foto.startsWith('/uploads/'))\" class=\"foto-avatar\">\r\n                {{ pessoa.sexo === 'Masculino' ? '👦' : (pessoa.sexo === 'Feminino' ? '👧' : '👶') }}\r\n              </span>\r\n            </td>\r\n            <td>{{ pessoa.name }}</td>\r\n            <td>{{ pessoa.responsavel }}</td>\r\n            <td>\r\n              <button mat-button color=\"primary\" type=\"button\" (click)=\"selecionarPessoa(pessoa)\">Selecionar</button>\r\n            </td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  </form>\r\n</mat-dialog-content>\r\n<mat-dialog-actions align=\"end\">\r\n  <button mat-button type=\"button\" (click)=\"onCancel()\">Cancelar</button>\r\n  <button mat-raised-button color=\"primary\" type=\"submit\" [disabled]=\"!presencaForm.valid || !pessoaSelecionada\" (click)=\"onSubmit()\">\r\n    Registrar\r\n  </button>\r\n</mat-dialog-actions> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}